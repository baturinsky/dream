(()=>{function u(t,e,n=1){return t.map((o,r)=>o+e[r]*n)}function ce(t,e=1){return t.map((n,o)=>n*e)}function pt(t,e){return u(t,e,-1)}function on(t){return t.reduce((e,n)=>e+n*n,0)**.5}function ut(t,e){return on(pt(e,t))}var Mt=2**31,l=Dt(123);function Dt(t=0){0<t&&t<1&&(t=~~(t*Mt));let e=n=>(t=t*16807%2147483647)%n;return l=n=>n==-1?t:n==null?e(Mt)/Mt:e(n),l}function O(t,e=l){if(!t)return null;let n=e(t.length);return t[n]}function z(t,e=l){let n=kt(t),o=e()*n-t[0],r=0;for(;o>=0;)o-=t[++r];return r}function Ht(t,e,n=l){let o=t.map(e),r=z(o);return t[r]}function B(t,e=o=>o,n=l){let o=z(Object.values(t).map(e),n);return Object.keys(t)[o]}function kt(t){return t.reduce((e,n)=>e- -n,0)}function V(t=l){let e="";for(let n=0;n<t(3)+2;n++)e+=O([..."kstnhmyrw",""],t)+O([..."aiueo",""],t);return rn(e)}function rn(t){return t?t[0].toUpperCase()+t.substring(1):""}function J(t){for(let e of Object.values(t))for(let n in e){let o=Number(e[n]);!isNaN(o)&&n!="colors"&&(e[n]=o)}return t}function pe(t,e=l){return t=t*100,t=(t%1>e()?1:0)+~~t,t/=100}function $(t,e=n=>n){return[...new Array(Math.max(t,0))].map((n,o)=>e(o))}var $t=t=>new Promise(e=>setTimeout(e,t));var A=J(Object.fromEntries(`Health:So called Hit Points:31
Strength:Dealing Damage:fg
Resilience:Damage reduction:qp
Greed:Find More:c4
Bloom:Regeneration:ba
Courage:Cover your allies:21
Anger:Avenge Damage:uv
Mercy:Heal Friends:lx
Knowledge:Writing and Reading:mn
Light:Strike True:je
Dark:Evade:o8
Time:Action Rate:lm
Purity:Resist Poison:rq
Venom:Poison:ba`.split(`
`).map((t,e)=>{let[n,o,r]=t.split(":"),i=n[0];return[i,{l:i,name:n,tip:o,colors:r,ind:e}]}))),U=J(Object.fromEntries(`Wooden:67:H:10
Iron:32:S:10
Stone:mn:R:10
Golden:c4:G:2
Plant:ba:B:5
Leather:56:C:5
Bone:ji:A:5
Cloth:tv:M:10
Paper:kl:K:5
Glass:wr:L:5
Obsidian:no:D:2
Copper:ef:T:5
Silver:lx:P:3
Asbestos:kb:V:1
Plain:::1`.split(`
`).map(t=>{let[e,n,o,r]=t.split(":");return[e,{colors:n,aspects:ht(o),chance:r}]}))),G=J(Object.fromEntries(`Door:2:10:Wooden:0:1:
Bed:2:H:Wooden:10:.5:
Column:3:R:Stone:0:1:
Apple:1:B:Plant:10:1:
Chair:2:H:Wooden:10:.5:
Chest:1:G:Wooden:10:1:
Shelf:2:G:Wooden:0:1:
Stand:2::Stone:0:1:
Display:2::Glass:0:1:
Plaque:2::Iron:0:1:
Big Table:2:R:Stone:0:1:
Display:2::Glass:0:1:
Dial:2::Glass:0:1:
Table:2::Wooden:10:.5:
Clock:1:T:Golden:1:1:
Pedestal:1::Wooden::1:
Mirror:2::Glass:5:1:
Angel:2:P:Silver:3:1:
Press:2::Iron:0:1:
Brush:1:::0:1:
Wine:1:A:Plant:5:1:
`.split(`
`).map((t,e)=>{let[n,o,r,i,a,p]=t.split(":");return[n,{name:n,scale:o,aspects:ht(r),material:i,chance:a??0,ind:e,placeh:p}]}))),dt=J(Object.fromEntries(`Human:G
Elf:B
Cat:D
Ogre:H
Fairy:M
Bird:L
Rat:D
Raven:A
Skel:C
Imp:V
Dog:S
Hippo:H
Lizard:B
Drago:P
Alien:K
Hare:T`.split(`
`).map((t,e)=>{let[n,o]=t.split(":");return[n,{name:n,aspects:ht(o),ind:e,chance:1/(10+e)}]}))),ue={...dt,...G};function ht(t=""){let e={};return[...t].forEach(n=>e[n]=(e[n]||0)+1),e}function fe(t,e,n=1){let o={};t??={},e??={};for(let r in{...t,...e})o[r]=(t[r]||0)+(e[r]||0)*n;return o}function de(t){let e="";for(let n of Object.keys(A).sort((o,r)=>t[o]-t[r]))t[n]>0&&(e+=`<div class="aspect" data-aspect=${n}><span class=num>${t[n].toFixed(2).replace(/(.00)/g,"")}<span> ${A[n].name}</div>`);return e}function Rt(t){return kt(Object.values(t))}function he(t,e,n){t[e]=(t[e]||0)+n}var bt=0;function be(t){bt=t}function ge(){return++bt}var R=256*2,S=128*2,In=64*2-1,Xt=(t,e,n)=>an(mn(n,t),e),I=(t,e)=>Xt("S",t,e),xe=(t,e)=>Xt("T",t,e),K=(t,e)=>Xt("O",t,e);function an(t,e){if(!t)debugger;if(!e)return t;let n=t.cloneNode();return h(n).filter=cn(e),h(n).drawImage(t,0,0),n}var _=32,sn=48,ln=64;var Ot=112;var gt=144,Ee=ln,ve=sn,ye=16;function mn(t,e,n=0){e=="O"&&(n=1);let o=Bt(8+n*2);return o.id=e+t,h(o).filter=`url(#_${e})`,h(o).drawImage(img,t%ye*8,~~(t/ye)*8,8,8,n,n,8,8),o}function h(t){return t.getContext("2d")}function cn(t){if(!It.has(t)){It.add(t);let[e,n]=[...t].map(r=>ft[Number.parseInt(r,36)]),o=`<filter id=f${t}><feColorMatrix type=matrix values="${e[0]} ${n[0]} 0 0 0  ${e[1]} ${n[1]} 0 0 0  ${e[2]} ${n[2]} 0 0 0  0 0 0 1 0" /></filter>`;DEFS.innerHTML+=o}return`url(#f${t})`}function Bt(t,e=t){let n=document.createElement("canvas");return n.classList.add("sprite"),n.width=t,n.height=e,n}var D=t=>h(t).createPattern(t,"repeat");function Te(t,e,n){let o=document.createElement("div");o.classList.add("ftext"),n&&o.classList.add(n),o.innerHTML=`<div>${t}</div>`,Scene.appendChild(o),setTimeout(()=>Scene.removeChild(o),3e3),Yt(o,e)}function Yt(t,e,n=""){Object.assign(t.style,Ft(e,n))}function Ft(t,e=""){return{left:`${t[0]}px`,top:`${t[2]}px`,transform:`translateZ(${t[1]}px) `+e}}function E(t,e,n,o=1){let r=h(t);o&&(r.globalAlpha=o),r.fillStyle=e,r.fillRect(...n||[0,0,t.width,t.height]),o&&(r.globalAlpha=1)}function F(t,e,n,o=1){return t.width=e*o,t.height=n*o,t.style.width=`${e}px`,t.style.height=`${n}px`,t}function W(t,e,n,o="canvas"){let r=document.createElement(o);return r.id=t,r.classList.add(...e.split(",")),Object.assign(r.style,n),Scene.appendChild(r),r}function Se(t,e){let n=t.cloneNode();return n.width*=e,n.height*=e,yt(n,t,0,0,e),n}function yt(t,e,n,o,r=1){h(t).imageSmoothingEnabled=!1,h(t).drawImage(e,n,o,e.width*r,e.height*r)}function N(t){return~~((1+b(t,"H")+t.level*.5)*10)}function xt(t){return~~(1e3/(1+b(t,"T")+t.level*.1+l()))}function pn(t,e){return~~(3+(b(t,"S")+t.level*.5)*l()*5-b(e,"R")*l())}function we(t,e){let n=t.dream==e.dream;n||v(e,Le(e));let o=!0;if(!n){let a=l()*(b(t,"L")*2+t.level)*2,p=l()*(b(e,"D")*2+e.level);o=a>p,o&&console.log(a,p)}let r=~~pn(t,e)*(n?-1:1),i=Math.abs(r);o&&(e.combat.hp-=r,e.combat.hp=Math.min(Math.max(0,e.combat.hp),N(e)),t.combat.aggro+=i),Te(o?`${i}`:"miss",u(e.pos,[-5+l(10),0,-35]),o?r>0?"red":"grn":""),tt(e)}function Ce(t){return t.combat.hp==N(t)}function Nt(t,e){return t.dream==e.dream}var un,jt,zt;function Pe(){let t="";Scene.innerHTML+=t,F(Back,256*3,128*5,2);let e=D(I("gf",2));un=$(3+1,n=>{let o=W(`w${n}`,"wall",{left:`${n*256}px`});return F(o,64,128*5,2),E(o,e),o}),jt=$(5+1,n=>F(W(`f${n}`,"floor",{top:`${++n*128}px`}),256*3,64,2)),zt=$(15,n=>F(W(`c${n}`,"curtain",{top:`${~~(n/3)*128}px`,left:`${n%3*256}px`}),256,128,2)),vt()}var Tt=class{constructor(e){this.id=e;this.stage=0;this.dreamStart=0;this.col=e%3,this.row=~~(e/3),this.l=256*this.col*2,this.t=128*this.row*2,this.pos=[e%3*256,0,128*~~(e/3+1)]}md(){d({...ot,shape:80,colors:"ef",type:"Door",level:this.id,scale:2,pos:this.doorPos()})}draw(){Dt(this.id*99+(this.dream?this.stage+this.dreamStart:0));let e=jt[this.row],n=D(I("ba",9));if(this.dream){let i=h(Back);i.save(),i.translate(this.l,this.t);let a=K("57",Ot),p=K("a9",Ot+2);i.fillStyle="#008",i.fillRect(0,0,R,S),i.fillStyle=n,i.fillRect(0,0+S*.6,R,S*.4+3);for(let P=60;P>4;P--){let mt=2*P**.7,ct=l(R);i.save(),i.translate(ct,S-mt-90);let Q=60/(3+mt*.6);i.scale(Q,Q),yt(Back,a,0,0),yt(Back,p,0,-3),i.restore()}i.restore(),E(e,n);let c=Se(xe("45",11),16);E(e,D(c),void 0,.5)}else{let i=D(I("2f",l(3)+1));E(Back,i,[this.l,this.t,R,S]),E(e,D(I("rq",l(3)+1)))}let o=D(I("2g",1)),r=zt[this.id];h(r).clearRect(0,0,R,S),this.open?(E(r,o,[0,0,10,S]),E(r,o,[0,S-10,R,10])):E(r,o,[0,0,R,S])}removeEnemies(){this.chars(!0).forEach(e=>Z(e))}toggleDream(e){this.dream=e,this.draw();for(let n of this.entries())v(n,[]),Kt(n,""),e||(n.combat={},n.dream&&Z(n)),!n.dream&&n.kind!=1&&(n.div.style.display=e?"none":"block"),tt(n)}entries(e){return Object.values(y).filter(n=>X(T(n))==this&&(e===void 0||!n.dream==!e))}chars(e){return this.entries(e).filter(n=>n.kind==1)}doorPos(){return u(this.pos,[256/2,1,0])}async wake(){this.blind(),await $t(400),this.toggleDream(!1),this.stage=0}async sleep(e){this.blind(),await $t(400),this.toggleDream(!0),this.aspects=e.aspects,this.level=e.level,this.dreamStart=Date.now(),this.nextEncounter()}nextEncounter(){for(let e=0;e<this.stage+1;e++)d({...nt,level:1,colors:"nm",type:Me(),name:V(),chest:et(_+2,"lk"),pos:this.doorPos(),dream:!0});for(let e of[!0,!1]){let n=this.chars(e),o=u(this.pos,[(e?.3:.7)*256,0,0]);n.forEach((r,i)=>{r.pos=u(o,[0,((i+.5)/n.length*.7+.3)*64,0]),r.right=e,r.combat={pos:r.pos,hp:N(r),delay:xt(r),aggro:0},tt(r),q(r)})}this.continueCombat()}endCombat(){this.living().filter(e=>!e.dream).length==0?this.wake():(this.stage++,this.removeEnemies(),this.chars().forEach(e=>v(e,w(e,u(e.combat.pos,[-100,0,0])))),this.blind(),this.chars()[0].actionsQueue.push(()=>this.nextEncounter()))}living(){return this.chars().filter(e=>e.combat.hp>0)}continueCombat(){if(!this.dream)return;let e=this.living(),n=Math.min(...e.map(a=>a.combat.delay)),o=e.find(a=>a.combat.delay==n);if(!o)return this.endCombat();let r=z([b(o,"S"),b(o,"M")])==1,i;if(r&&(i=Ht(e,a=>Nt(o,a)?N(a)/a.combat.hp:0)),(!i||Ce(i))&&(r==!1,i=Ht(e,a=>Nt(o,a)?0:.1*a.level+Math.max(0,b(a,"C")-b(a,"D")-b(o,"L"))+b(o,"A")*a.combat.aggro)),!i)return this.endCombat();v(o,Ae(o,i,()=>e.forEach(a=>a.combat.delay-=n)))}blind(){let e=Ft(u(this.pos,[0,64,-128])),n=W("","blind",e);F(n,256,128,8),E(n,D(I("on",11))),setTimeout(()=>Scene.removeChild(n),3900)}};function vt(){C.forEach(t=>t.draw())}function X(t){return C[~~(t[0]/256)+3*~~(t[2]/128-1)]}function x(t){return X(T(t))}var fn="scaleX(-1) translateX(-100%)";var De=1,St=2,Wt=3;function j(t,e,n){let o=t.pos,r=Date.now(),{stopDistance:i,mode:a}=n||{};a??=De;let p=a==St?.3:.1,c=ut(t.pos,e)/p,P=e[0]-t.pos[0];P!=0&&a==De&&(t.right=P>0);let mt=pt(e,o);return()=>{let ct=Date.now(),Q=Math.min(ct-r,c);t.pos=u(o,mt,c?Q/c:1);let me=Q>=c||ut(t.pos,e)<(i??0);return t.transform=me?"":`rotateZ(${a==St?-10:a==Wt?10:Math.sin(ct/100)*5}deg)`,!me}}function dn(t){return t.right?1:-1}function w(t,e,n=0){let o=x(t),r=X(e);if(r==null)debugger;return r==o?[()=>j(t,e,{stopDistance:n})]:[()=>j(t,o.doorPos()),()=>t.pos=u(r.doorPos(),[5,0,0]),()=>j(t,e,{stopDistance:n})]}function qt(t){let e=Date.now();return()=>Date.now()<e+t}function Le(t){return[()=>j(t,u(t.combat.pos,[dn(t)*-20,0,0]),{mode:Wt}),()=>t.combat.hp?j(t,t.combat.pos,{mode:Wt}):null]}function Ae(t,e,n=()=>{}){return[()=>j(t,e.combat.pos,{mode:St}),()=>{we(t,e),n()},()=>j(t,t.combat.pos,{mode:St}),()=>{t.combat.delay=xt(t),x(t).continueCombat()}]}function wt(t){return[t.size[0]*t.scale,t.size[1]*t.scale]}function q(t){!t||(Ct(t),L(t))}function L(t,e){if(!t)return;if(!t.animation&&t.actionsQueue){let a=t.actionsQueue.shift();if(a){let p=a();p instanceof Function&&(t.animation=p)}}t.animation&&t.animation()==!1&&delete t.animation;let n=t.div,o=e?u(t.pos,e):t.pos,r=pt(o,hn(t));n.style.opacity=t.opacity,n.classList.toggle("current",t==s),n.classList.add("k"+t.kind),n.classList.toggle("right",!!t.right);let i=(t.right?fn:"")+(t.transform??"")+(t.combat?.hp==0?"rotateZ(90deg)translateX(8px)":"");Yt(n,r,i)}function hn(t){return[wt(t)[0]/2,0,wt(t)[1]]}function Qt(t){let e=Bt(1),n=document.createElement("div");return n.classList.add("entity"),n.appendChild(e),n.style.position="absolute",e.id="s"+t.id,t.canvas=e,t.div=n,t.kind==1&&(t.title=document.createElement("div"),t.title.classList.add("etitle"),n.appendChild(t.title)),Ct(t),e}function He(t){return t&&[t.shape,t.colors]}function Ct(t){t.makeBits&&(t.bits=t.makeBits(t));let e=t.canvas,n=1;if(e.width=t.size[0]*n,e.height=t.size[1]*n,e.style.transformOrigin=t.origin,e.style.transform=`scale(${t.scale})`,h(e).imageSmoothingEnabled=!1,t.bits)for(let o=0;t.bits[o];o++){let r=t.bits[o];if(!r||!r[0])continue;let i=K(r[1],r[0]);h(e).drawImage(i,t.bitPos[o][0]*n,t.bitPos[o][1]*n,i.width*n,i.height*n)}}function d(t){t.id??=ge(),t.held=[];let e={canvas:Qt(t),floor:0,actionsQueue:[],...t},n=ue[e.type];if(n&&(e.type??=n.name,n.placeh&&(e.mountPoint??=[5,0,9-n.placeh*8]),e.shape??=[0,16,80,0,0][e.kind]+n.ind,e.scale??=n.scale,e.material??=l(2)||!n.material?O(Object.keys(U)):n.material,console.log(e.mountPoint)),e.colors=e.colors||U[e.material]?.colors,e.scale??=1,Ct(e),e.pos&&(y[t.id]=e,Scene.appendChild(e.div),t.className&&e.div.classList.add(t.className),L(e)),!e.aspects)for(let o of[U[e.material],dt[e.type],G[e.type]])e.aspects=fe(e.aspects,o?.aspects);return e}function Z(t){t.div.parentElement?.removeChild(t.div),delete y[t.id]}function it(t,e,n){e.kind==2&&(t.div.appendChild(e.div),t.held.unshift(e),e.parent=t,e.pos=n??ce(t.mountPoint,t.scale),L(e))}function Vt(t,e){let n=t.held.shift();return n&&(n.pos=e??t.pos,Scene.appendChild(n.div),delete n.parent,L(n)),n}function et(t,e){return{...H,shape:t,colors:e}}function ke(t,e){e&&(t.colors=e.colors,t.shape=e.shape,t.scale=e.scale),Ct(t)}function T(t,e=!0){return e?Be(rt(t).pos):rt(t).pos}function rt(t){return t.parent?rt(t.parent):t}function at(t){return X(T(t)).dream}function Jt(t,e){if(!e)return;let n=A[e];return d({...H,shape:gt+n.ind,colors:n.colors,pos:u(t.pos,[0,0,-30]),className:"thought",deadAt:Date.now()+3e3})}function Ut(t){return t.level??Rt(t.aspects)}function _t(t){if(!t||!ee(t))return;let e="",n="";return t.kind==1?e=`${t.name} the ${t.type||"X"}`:e=`${t.material||""} ${t.type}`,n+=`Level ${Ut(t)}<br/><br/>`,t.aspects&&(n+=de(t.aspects)),[e,n]}function bn(t){let e=x(t).entries(),n=z(e.map(o=>{if(o==t||!ee(o))return 0;let r=ut(t.pos,T(o));return Ut(o)/(10+r)*$e(t,o)}));return e[n]}function gn(t,e){let n=B(e.aspects),o=Ut(e)*$e(t,e)*.01;o=pe(o),o&&(he(t.aspects,n,o),t.recent.unshift(e.id),t.recent.length=20,t==te&&st(t),Jt(e,n))}function $e(t,e){t.recent??=[];let n=t.recent.indexOf(e.id);return n==-1&&(n=1e6),1-1/(1+n)}function Re(t){if(!yn(t))return;let e=bn(t);!e||v(t,[...w(t,T(e),10),()=>gn(t,e),()=>qt(1e3)])}function yn(t){return!t.actionsQueue?.length&&!t.animation}function Ie(t){let e=Rt(t.aspects);if(t.level<e){let n=B(t.aspects);t.aspects[n]=Math.max(0,t.aspects[n]-.01*~~(e-t.level+1))}}function Xe(t){return x(t).dream}function v(t,e){!t||(t.actionsQueue=e,delete t.animation)}function b(t,e){return t.aspects[e]??0}function Kt(t,e){t.title&&(t.title.innerHTML=e)}function tt(t){Kt(t,t.combat?.hp>=0?`${t.combat?.hp}/${N(t)} hp`:"")}function Me(){return B(dt,t=>t.chance)}function Oe(t,e){let n=t.held[0];if(n?.type=="Brush"){e.colors=n.colors,q(e);return}e.type=="Bed"&&x(t).sleep(t)}var ne=[],Lt=[-380,20],Fe=600;function Be(t){return[t[0],t[1],Math.ceil(t[2]/128)*128]}function Ye(t,e){ke(k,t),k.pos=e,Scene.appendChild(k.div),L(k)}function oe(){Scene.style.left=`${Lt[0]}px`,Scene.style.top=`${Lt[1]}px`}function Ne(){onpointerup=t=>{ne[t.button]=!1},onpointerdown=t=>{ne[t.button]=!0;let[e,n,o,r]=Pt(t),i=[e,n,(r+1)*128],a;if(s&&o=="f"&&!t.shiftKey&&(X(i).dream&&X(i).wake(),(t.button==2||t.button==0&&!s.held.length)&&(a=w(s,i)),t.button==0&&s.held.length&&(a=[...w(s,i),()=>Vt(s)])),s&&o=="s"&&!t.shiftKey){let c=y[r];if(c&&c!=s){if(at(c)){x(c).wake();return}t.button==2&&(a=[...w(s,T(c),15),()=>Oe(s,c)]),t.button==0&&(c.kind==1?lt(rt(c)):a=[...w(s,T(c)),()=>{if(s.held.length){let P=Vt(s);P&&it(c,P)}else it(s,c)}])}}a&&!at(s)&&v(s,[...a,()=>qt(5e3)]),oncontextmenu=c=>{c.shiftKey||c.preventDefault()},t.target.classList.contains("sprite")},onmousemove=t=>{if(ne[1]){let c=.5;Lt=u(Lt,[t.movementX,t.movementY],c),oe()}let[e,n,o,r]=Pt(t),i=[e,n,(r+1)*128],a=s?.held[0],p=y[r];if(st(p),a&&(o=="f"&&Ye(a,i),o=="s"&&p&&p.kind==2)){let c=u(p.pos,[0,0,-wt(p)[1]*.7]);Ye(a,c),p.div.parentElement?.appendChild(k.div)}t.preventDefault()},onwheel=t=>{Fe-=t.deltaY*.2,re()}}var te;function ee(t){return t.kind==2||t.kind==1}function st(t){let e=_t(t)||_t(s);te=t||s,Info.innerHTML=e?`<h1>${e[0]}</h1>${e[1]}`:""}function re(){Scene.style.transform=`translateZ(${Fe}px)`}function Pt(t){let[e,n,o]=[t.target.id,t.offsetX,t.offsetY],r=e[0],i=1*e.substring(1);return[n,o,r,i]}function ie(t){return[...t.matchAll(/(\w)(\w)(\w)/g)].map(e=>[...e.slice(1,4).map(n=>~~(Number.parseInt(n,36)/36*100)/100),1])}var Ze="906j05u58zdczpdrfag867240125869i8lp8zu7zi8t94h34724i97wlfzuozzvqrrfjj68a13509d4kngtqzvuzjnq8kd3duzzxxx";var xn="id,name,kind,pos,scale,right,shape,colors,aspects,dream,type,material,recent,level,combat,hrz";function ae(t){return t&&{...je(t,xn),chest:ae(t.chest),held:t.held?.map(e=>ae(e))}}function je(t,e){return Object.fromEntries(e.split(",").map(n=>[n,t[n]]))}function se(t){if(!t)return null;let e=d({...Ke[t.kind],...t,chest:se(t.chest)});return t.held?.forEach(n=>{it(e,se(n),n.pos)}),e}function ze(){return{cur:s.id,lid:bt,rooms:C.map(t=>je(t,"start,dream,aspects,level,open,stage")),all:Object.values(y).filter(t=>!t.parent&&t.kind!=4).map(t=>ae(t))}}function Ge(t){console.log(t),Object.values(y).forEach(e=>Z(e)),t.all.forEach(e=>se(e)),lt(y[t.cur]),be(t.lid),t.rooms.forEach((e,n)=>Object.assign(C[n],e));for(let e of C)e.dream&&(e.toggleDream(!0),e.continueCombat())}var Ve=1,Je=2,Ue=0;addEventListener("pointerdown",t=>{let[e,n,o,r]=Pt(t);if(o=="f"&&t.button==0&&t.shiftKey){let a=Qe();a.pos=[e,n,r*128],L(a)}o=="O"&&(Ue=r),o=="C"&&(t.button==0?Ve=r:Je=r),Preview.innerHTML="";let i=Qe();Preview.appendChild(i.canvas)});var We="ayhiadream",qe=0;addEventListener("keydown",t=>{if(t.code=="KeyD"&&Debug.classList.toggle("dn"),t.code=="KeyS"){let e=ze();console.log(e),localStorage.setItem(We,JSON.stringify(e))}if(t.code=="KeyL"){let e=localStorage.getItem(We);e&&Ge(JSON.parse(e))}if(t.code=="KeyT"){let e=x(s).entries(),n=O(e);v(s,w(s,T(n),15))}if(t.code=="KeyE"){let e=Object.keys(A)[qe];Jt(s,e),qe++}t.code=="KeyN"&&(at(s)?x(s).wake():x(s).sleep(s))});function Qe(){return d({...H,shape:Ue,colors:Ve+""+Je,pos:[0,0,0]})}var nt={bitPos:[[3,1],[2,14],[2,10],[2,13]],mountPoint:[0,0,16],size:[16,24],origin:"75% 50%",kind:1,makeBits:t=>[[t.shape,t.colors],[Ee,t.colors],He(t.chest),[ve,t.colors]]},ot={bitPos:[[0,0]],size:[10,10],kind:3,makeBits:t=>t&&[[t.shape,t.colors]]},At={...ot,kind:2},H={...ot,kind:4},Ke=[,nt,At,ot,H],ft=ie(Ze),It=new Set,Zr,_e,En,k,en,s,y={};onload=()=>{t:console.log(123);img.onload=vn,img.src="16cols.gif"};function lt(t){let e=s;s=t,q(e),s&&(q(s),s.div.appendChild(en.div))}var C=[];function vn(){C=$(15,t=>new Tt(t)),Pe(),C.forEach(t=>t.md()),re(),Ne(),oe(),_e=d({...nt,level:1,shape:18,colors:"nm",type:"Cat",name:V(),chest:et(_+2,"lk"),pos:[320,10,128]}),En=d({...nt,level:1,shape:26,material:"Plain",colors:"qp",type:"Dog",name:V(),chest:et(_+1,"ba"),pos:[340,10,128]}),d({...At,type:"Brush",pos:[50,10,128]}),d({...At,type:"Brush",pos:[60,10,128]}),C[1].open=!0,k=d({...H,opacity:.5,shape:1,colors:"ab",pos:[0,0,0],noclick:!0}),k.canvas.classList.add("phantom");for(let t=0;t<30;t++){let e=B(G,n=>n.chance);d({...At,type:e,pos:[l(3)*256+10+l(256-20),l(64),128]})}en=d({...H,shape:8,colors:"ab",pos:[8,0,4],className:"pointer"}),lt(_e),vt(),nn(0),st()}var tn=0,le=0;function nn(t){let e=t-tn||1;tn=t;let n=Date.now();le=le*.9+1e3/e*.1,FPS.innerText=`FPS: ${~~le}`,Object.values(y).forEach(o=>{(o.actionsQueue.length||o.animation)&&L(o),o.deadAt&&n>o.deadAt&&Z(o),o.kind==1&&(Xe(o)||e>l()*3e3&&(Ie(o),Re(o))),document.querySelectorAll(".aspect").forEach(r=>{let i=A[r?.dataset?.aspect];if(!i)return;delete r?.dataset?.aspect;let a=Qt({...H,shape:gt+i.ind,colors:i.colors});r.prepend(a)})}),requestAnimationFrame(nn),s?.held.length||(k.div.style.opacity="0")}})();
//# sourceMappingURL=bundle.js.map
